var id=0;$(document).ready(function(){$("#frm_feeds").formValidation({framework:"bootstrap",icon:null,fields:{f_title:{validators:{regexp:{regexp:/^[0-9a-zA-ZÑñ .,-]+$/i},stringLength:{max:30},notEmpty:{message:""}}},f_brgy:{validators:{regexp:{regexp:/^[0-9a-zA-ZÑñ .,-]+$/i},stringLength:{max:30}}},f_date:{validators:{date:{format:"YYYY-MM-DD",message:""},notEmpty:{message:""}}}}}).on("success.form.fv",function(e){return save_feed(),!1}).on("err.field.fv",function(e,s){})});var $dt_feeds=$("#dt_feeds"),$dt_feeds2=$("#dt_feeds2"),dt_feeds=$dt_feeds.DataTable({ajax:{type:"GET",url:base_url+"feeds.txt",dataSrc:""},columns:[{data:function(e,s,t,a){var o="";return o+='<div class="panel panel-default">',o+='<div class="panel-body">',o+='<section class="post-heading">',o+='<div class="row">',o+='<div class="col-lg-11">',o+='<div class="media">',o+='<div class="media-left">',o+='<a href="#">',o+='<img class="media-object photo-profile" src="https://scontent.fmnl17-1.fna.fbcdn.net/v/t1.0-1/c0.0.60.60/p60x60/30415667_237958176769169_7508514551885725696_n.jpg?_nc_cat=0&oh=245d5dc4a4bf6920169b1b4bded3f9e2&oe=5BB4A2F4" width="40" height="40" alt="...">',o+="</a>",o+="</div>",o+='<div class="media-body">',o+='<a href="#" class="anchor-username"><h4 class="media-heading">'+e.f_title+"</h4></a>",o+='<a href="#" class="anchor-time"> Posted by:'+e.a_id+"</a>",o+="</div>",o+="</div>",o+="</div>",o+='<div class="col-lg-1" style="text-align: center;">',o+='<a href="#" data-toggle="modal" data-target="#myModal"><i class="fa fa-trash"></i></a>',o+="</div>",o+="</div>",o+="</section>",o+='<section class="post-body">',o+='<p class="post-content">'+e.f_content+"</p>",o+='<div style="background-image: url('+base_url+"img/feeds/thumbs/"+e.f_thumb+');  background-repeat: no-repeat; background-size: contain; height: 40vh;"></div>',o+="</section>",o+="</div>",o+="</div>"}}],dom:'<"wrapper"Bfit>',scrollY:"85vh",ordering:!1,bInfo:!1,searching:!1,scrollX:!0,scrollCollapse:!0,paging:!1,buttons:[],fnInitComplete:function(e,s){$(".alert-info .glyphicon-remove").trigger("click"),$("body").find(".dataTables_scrollBody").addClass("scrollbar"),$("body").find("#f_content").addClass("scrollbar")}}),dt_feeds2=$dt_feeds2.DataTable({ajax:{type:"GET",url:base_url+"feeds.txt",dataSrc:""},columns:[{data:function(e,s,t,a){var o="";return o+='<div class="panel panel-default">',o+='<div class="panel-body">',o+='<section class="post-heading">',o+='<div class="row">',o+='<div class="col-md-11">',o+='<div class="media">',o+='<div class="media-left">',o+='<a href="#">',o+='<img class="media-object photo-profile" src="http://cityofsanfernando.gov.ph/cdrrm/assets/images/logo-icon.png" width="40" height="40" alt="...">',o+="</a>",o+="</div>",o+='<div class="media-body">',o+='<a href="#" class="anchor-username"><h4 class="media-heading">'+e.f_title+"</h4></a>",o+='<a href="#" class="anchor-time"> Posted by:'+e.a_id+"</a>",o+="</div>",o+="</div>",o+="</div>",o+="</div>",o+="</section>",o+='<section class="post-body">',o+='<p class="post-content">'+e.f_content+"</p>",o+="</section>",o+="</div>",o+="</div>"}}],dom:'<"wrapper"Bfit>',scrollY:"85vh",ordering:!1,bInfo:!1,searching:!1,scrollX:!0,scrollCollapse:!0,paging:!1,buttons:[],fnInitComplete:function(e,s){$(".alert-info .glyphicon-remove").trigger("click"),$("body").find(".dataTables_scrollBody").addClass("scrollbar"),$("body").find("#f_content").addClass("scrollbar")}});function save_feed(){if($is_processing=$(document).find(".toast.toast-info").length,0==$is_processing){var e=$("#frm_feeds").serializeObject();toastr.info("Processing","Please wait..."),postAjax(base_url+"feed/savefeed/",e,function(e){"yes"==e.status?($("#f_id").val(e.id),dzFeedPhotos.processQueue(),toastr.clear(),toastr.success(e.content,e.title),$("#frm_feeds")[0].reset(),dzFeedPhotos.queuecomplete()):(toastr.clear(),toastr.error(e.content,e.title))})}return!1}Dropzone.options.myAwesomeDropzone=!1,Dropzone.autoDiscover=!1;var dzFeedPhotos=new Dropzone("#post_photos",{url:base_url+"feed/uploadphoto/",paramName:"file",addRemoveLinks:!0,maxFiles:1,maxFilesize:4,autoProcessQueue:!1,parallelUploads:1,acceptedFiles:".jpg, .jpeg, .png",init:function(){this.on("addedfile",function(e,s){}),this.on("sending",function(e,s,t){t.append("id",$("#f_id").val())}),this.on("sendingmultiple",function(e,s,t){}),this.on("uploadprogress",function(e,s){toastr.clear(),toastr.info(s+"%","Uploading...")}),this.on("totaluploadprogress",function(e){}),this.on("success",function(e,s){var t=jQuery.parseJSON(s);"yes"==t.status?(toastr.clear(),toastr.success(t.content,t.title),this.removeAllFiles()):(toastr.clear(),toastr.error(t.content,t.title)),$("#f_id").val(""),this.removeAllFiles()}),this.on("error",function(e,s){toastr.clear(),toastr.error(s,"Error Occured"),$("#f_id").val("")}),this.on("queuecomplete",function(){this.removeAllFiles()}),this.on("removedfile",function(e){})}});